var visualizer=function(){"use strict";var t=function(t,e,n){return e<n?t<e?e:t>n?n:t:t<n?n:t>e?e:t};function e(t){const e=t.toString(16);return 1===e.length?"0"+e:e}function n(t,n,a,o,i){let r,h,l,c,s,f,u,d;switch(t&&void 0===n&&void 0===a&&(n=t.s,a=t.v,t=t.h),f=a*(1-n),u=a*(1-(s=6*t-(c=Math.floor(6*t)))*n),d=a*(1-(1-s)*n),c%6){case 0:r=a,h=d,l=f;break;case 1:r=u,h=a,l=f;break;case 2:r=f,h=a,l=d;break;case 3:r=f,h=u,l=a;break;case 4:r=d,h=f,l=a;break;case 5:r=a,h=f,l=u}return r=Math.floor(255*r),h=Math.floor(255*h),l=Math.floor(255*l),o?"#"+e(r)+e(h)+e(l):i?[r,h,l]:"rgb("+r+","+h+","+l+")"}const a=[],o=[];!function(){for(let t=0;t<360;t++)for(let e=0;e<100;e++){const i=n(t/360,1,e/100,!0,!1);a.push(i);const r=n(t/360,1,e/100,!1,!0);o.push(r)}}();var i={bigColorMap:a,bigColorMap2:o};function r(){this.cx=-200,this.cy=-200,this.regenerate()}function h(e={}){let{ctx:n,cv:a,bandCount:o,rotateAmount:h}=e;let l,c,s=0,f=[!0,!1],u=0;const d=document.createElement("img");!function(t){const e=document.createElement("canvas"),n=e.getContext("2d");e.width=300,e.height=300;const a=n.createRadialGradient(150,150,0,150,150,150);a.addColorStop(0,"rgba(255, 255, 255, 1.000)"),a.addColorStop(1,"rgba(255, 255, 255, 0.000)"),n.fillStyle=a,n.fillRect(0,0,300,300),t.src=e.toDataURL()}(d);const g=[];for(let t=0;t<25;t++)g.push(new r);const m=function(){l=f[s=(s+1)%f.length]};return m(),Object.freeze({dampen:!0,vary:m,resize:function(){c=Math.max(a.width,a.height)},draw:function(e){if(n.save(),n.fillStyle="#000000",n.fillRect(0,0,a.width,a.height),n.translate(a.width/2,a.height/2),l){n.globalCompositeOperation="screen";for(let t=0;t<g.length;t++)n.globalAlpha=g[t].intensity,n.drawImage(d,g[t].x,g[t].y),g[t].move()}n.rotate(u),l&&(n.globalCompositeOperation="multiply",n.globalAlpha=1);for(let a=0;a<o;a++){n.rotate(h);let r=Math.floor(360/o*a)%360,l=t(Math.floor(e[a]/2),10,99);n.fillStyle=i.bigColorMap[100*r+l],n.beginPath(),n.arc(0,0,1.5*c,0,h+.1),n.lineTo(0,0),n.fill(),n.closePath()}u+=.002,n.restore()}})}function l(e={}){let{ctx:n,cv:a,bandCount:o,image:r,fftSize:h}=e;let l,c,s,f,u,d;const g=[];let m,M,p=0;const w=function(){m.width=l,m.height=c;const t=a.parentElement.innerWidth||a.parentElement.clientWidth,e=a.parentElement.innerHeight||a.parentElement.clientHeight,o=Math.floor(t/l),i=Math.floor(e/c);0===(u=Math.min(o,i))&&(u=1),u*=window.devicePixelRatio||1,s=Math.floor((a.width-l*u)/2),f=Math.floor((a.height-c*u)/2),n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1};if(r){let e=document.createElement("img");e.onload=function(){!function(e){l=e.width,c=e.height,(m=document.createElement("canvas")).width=l,m.height=c,(M=m.getContext("2d")).clearRect(0,0,l,c),M.drawImage(e,0,0,l,c);const n=M.getImageData(0,0,l,c);d=M.createImageData(l,c);for(let e=0;e<l*c;e++){let a=Math.round(.2126*n.data[4*e]+.7152*n.data[4*e+1]+.0722*n.data[4*e+2]);g.push(Math.round(t(a,0,255)/255*o)),d.data[4*e+3]=a<1?0:255}}(e),w()},e.src=r}return Object.freeze({dampen:!0,resize:w,draw:function(e){if(d){n.save(),n.clearRect(0,0,a.width,a.height),n.translate(s,f),p+=1;for(let n=0;n<g.length;n++){let a=g[n],o=Math.floor(e[a]+p)%360,r=100*Math.sqrt(a/e.length*(e[a]/h));r=t(Math.floor(r),0,99);let l=i.bigColorMap2[100*o+r];d.data[4*n]=l[0],d.data[4*n+1]=l[1],d.data[4*n+2]=l[2]}M.putImageData(d,0,0),n.scale(u,u),n.drawImage(m,0,0),n.restore()}}})}return r.prototype.regenerate=function(){var t=2*Math.random()*Math.PI;this.x=Math.cos(t)*Math.random()*500+this.cx,this.y=Math.sin(t)*Math.random()*500+this.cy,t=2*Math.random()*Math.PI,this.dx=Math.cos(t),this.dy=Math.sin(t),this.intensity=0,this.di=.01+Math.random()/50},r.prototype.move=function(){this.x+=this.dx*Math.random()*4,this.y+=this.dy*Math.random()*4,this.intensity+=this.di,this.intensity<0?this.regenerate():this.intensity>1&&(this.intensity=1,this.di*=-1)},function(e={}){const a=document.createElement("canvas");let o;e.parent?(o="string"==typeof e.parent?document.querySelector(e.parent):e.parent).appendChild(a):(a.style.position="absolute",a.style.left="0",a.style.top="0",document.body.appendChild(a),o=window);const r=a.getContext("2d"),c=e.image,s=[];let f,u,d,g=0;const m=Math.round(256/3),M=[],p=2*Math.PI/m,w=function(e){d=new(window.AudioContext||window.webkitAudioContext),b(e);for(let t=0;t<m;t++)M.push(0);const o={cv:a,ctx:r,bandCount:m,rotateAmount:p,lastVolumes:M,image:c,fftSize:256};s.push(function(e={}){let n,a,{ctx:o,cv:r,bandCount:h,rotateAmount:l}=e,c=0;const s=[[!1,!0],[!0,!1],[!1,!1]],f=function(){n=s[c=(c+1)%s.length][0],a=s[c][1]};return f(),Object.freeze({dampen:!0,vary:f,resize:function(){Math.min(r.width,r.height)},draw:function(e){o.clearRect(0,0,r.width,r.height);let n=r.width/h;for(let l=0;l<h;l++){let c=Math.floor(360/h*l),s=a?t(Math.floor(e[l]/1.5),25,99):99;o.fillStyle=i.bigColorMap[100*c+s];let f=r.height*(e[l]/255);o.fillRect(l*n,r.height-f,n,f)}}})}(o)),s.push(function(e={}){let n,a,o,r,{ctx:h,cv:l,bandCount:c,rotateAmount:s}=e,f=0,u=0;const d=[[!1,!0],[!0,!1],[!1,!1]],g=function(){o=d[u=(u+1)%d.length][0],r=d[u][1]};return g(),Object.freeze({dampen:!0,vary:g,resize:function(){const t=Math.min(l.width,l.height);n=.10625*t,a=1/800*t},draw:function(e){h.clearRect(0,0,l.width,l.height),h.translate(l.width/2,l.height/2),h.rotate(f);for(let l=0;l<c;l++){h.rotate(s);let f=Math.floor(360/c*l),u=99;r&&(u=t(Math.floor(e[l]/1.5),25,99)),h.fillStyle=i.bigColorMap[100*f+u],h.beginPath(),o?h.arc(0,0,n+Math.max(e[l]*a,2),0,s/2):h.arc(0,0,n+Math.max(e[l]*a,2),0,s+.005),h.lineTo(0,0),h.fill(),h.closePath()}h.fillStyle="#000000",h.beginPath(),h.arc(0,0,n,0,2*Math.PI,!1),h.fill(),h.closePath(),f+=.002,h.setTransform(1,0,0,1,0,0)}})}(o)),s.push(function(e={}){let n,a,o,r,{ctx:h,cv:l,bandCount:c,rotateAmount:s,lastVolumes:f}=e,u=0,d=[[!1],[!0]],g=0;const m=function(){a=d[u=(u+1)%d.length][0]};return m(),Object.freeze({dampen:!0,vary:m,resize:function(){const t=Math.min(l.width,l.height);o=.10625*t,r=1/800*t,n=2*Math.PI*o/c},draw:function(e){h.clearRect(0,0,l.width,l.height),h.translate(l.width/2,l.height/2),h.rotate(g);for(let l=0;l<c;l++){h.rotate(s);let u=Math.floor(360/c*l);if(a){let a=t(Math.floor(e[l]/1.5),25,99);h.fillStyle=i.bigColorMap[100*u+a],h.fillRect(-n/2,o,n,Math.max(2,e[l]*r))}else{let t=0;t=(e[l]+f[l])/2,h.fillStyle=i.bigColorMap[100*u+50],h.fillRect(-n/2,o+t,n,2),h.fillStyle=i.bigColorMap[100*u+99],h.fillRect(-n/2,o,n,e[l]*r)}}g+=.002,h.setTransform(1,0,0,1,0,0)}})}(o)),s.push(function(e={}){let a,o,i,r,h,{ctx:l,cv:c,bandCount:s,rotateAmount:f}=e,u=0,d=0;const g=[[2],[3]],m=[];for(let t=0;t<s;t++)m.push(0);const M=function(){i=g[d=(d+1)%g.length][0]},p=function(t,e){l.beginPath(),l.arc(0,0,t,0,e),l.stroke(),l.closePath()};return M(),Object.freeze({dampen:!1,resize:function(){const t=Math.min(c.width,c.height);a=Math.max(c.width,c.height),o=1/800*t,r=(h=.71*a)/i},draw:function(e){l.save(),l.clearRect(0,0,c.width,c.height),l.translate(c.width/2,c.height/2),l.rotate(u);for(let h=0;h<s;h++){l.rotate(f),l.lineWidth=1+e[h]/256*5;let c=360/s*h/360,u=t(1*e[h]/150,.3,1);l.strokeStyle=n(c,1,u),m[h]+=Math.max(50,e[h])*o/40,m[h]%=r;for(var a=0;a<i;a++)p(m[h]+a*r,.75*f)}u+=.002,l.restore()},vary:M})}(o)),s.push(h(o)),s.push(function(e={}){let n,a,{ctx:o,cv:r}=e,h=0,l=[[!1],[!0]],c=0;const s=function(){n=l[h=(h+1)%l.length][0]};return s(),Object.freeze({dampen:!0,vary:s,resize:function(){a=Math.max(r.width,r.height)},draw:function(e){c+=.25,o.clearRect(0,0,r.width,r.height);let a=0,h=Math.floor(5),l=h,s=0,f=0,u=0,d=r.width/11,g=r.height/11;for(;a<121;){switch(s%4){case 0:f=1,u=0;break;case 1:f=0,u=1;break;case 2:f=-1,u=0;break;case 3:f=0,u=-1}for(var m=0;m<Math.floor(s/2)+1;m++){let r=Math.floor(360/121*a+c)%360,s=t(Math.floor(e[a]/1.5),10,99);o.fillStyle=i.bigColorMap[100*r+s];let m=.9;n&&(m=e[a]/255/4+.65),o.fillRect(h*d+d/2*(1-m),l*g+g/2*(1-m),d*m,g*m),h+=f,l+=u,a++}s++}o.setTransform(1,0,0,1,0,0)}})}(o)),s.push(function(e={}){let n,a,o,{ctx:r,cv:h,bandCount:l,rotateAmount:c}=e,s=0;return Object.freeze({dampen:!0,resize:function(){o=Math.min(h.width,h.height),a=Math.sqrt(h.width*h.width+h.height*h.height),n=.10625*o},draw:function(e){s+=1,r.clearRect(0,0,h.width,h.height),r.translate(h.width/2,h.height/2),r.rotate(Math.PI/2);for(let h=0;h<l;h++){let f=Math.floor(360/l*h+s)%360,u=t(Math.floor(e[h]/1.5),15,99);r.fillStyle=i.bigColorMap[100*f+u];let d=o/2;d-=(d-n)*(e[h]/255),r.beginPath(),r.arc(0,0,a/2,-c/2,c/2),r.lineTo(d,0),r.fill(),r.closePath(),r.rotate(c)}r.setTransform(1,0,0,1,0,0)}})}(o)),s.push(l(o)),y(),requestAnimationFrame(v),window.onresize=function(){y()}},b=function(t){const e=d.createMediaStreamSource(t);(f=d.createAnalyser()).smoothingTimeConstant=.2,f.fftSize=256,u=new Uint8Array(f.frequencyBinCount),e.connect(f)},y=function(){const t=window.devicePixelRatio||1,e=o.innerWidth||o.clientWidth,n=o.innerHeight||o.clientHeight;a.width=e*t,a.height=n*t,a.style.width=e+"px",a.style.height=n+"px",s[g].resize()},v=function(){if(f.getByteFrequencyData(u),!0===s[g].dampen)for(let t=0;t<u.length;t++)M[t]>u[t]&&(u[t]=(u[t]+M[t])/2);s[g].draw(u),requestAnimationFrame(v)};return function(t){if(e.stream)return setTimeout(t,0,null,e.stream);navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(function(e){t(null,e)}).catch(function(e){t(e)})}(function(t,e){if(t)throw console.log(t),new Error("Unable to start visualization. Make sure you're using a modern browser with a microphone set up, and that you allow the page to access the microphone.");w(e)}),Object.freeze({addVisualization:function(t){const e={cv:a,ctx:r,bandCount:m,rotateAmount:p,lastVolumes:M,image:c,fftSize:256};s.push(t(e))},setMediaStream:b,showNextVisualization:function(){g=(g+1)%s.length,y()},showVisualization:function(t){t<0&&(t=0),t>=s.length&&(t=s.length-1),g=t,y()},vary:function(){s[g].vary&&s[g].vary()}})}}();
